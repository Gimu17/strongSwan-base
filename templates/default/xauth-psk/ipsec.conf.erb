# ipsec.conf - strongSwan IPsec configuration file

# basic configuration

config setup
    # nat_traversal=<%= node[:strongswan][:server][:tunable][:ipsec][:natt] %>
    
conn %default
    ikelifetime=60m
    keylife=20m
    rekeymargin=3m
    keyingtries=1
    keyexchange=<%= node[:strongswan][:server][:tunable][:ipsec][:keyexchange] %>
    pfs=no
    authby=secret

conn client
    ike=<%= node[:strongswan][:server][:tunable][:ipsec][:ike] %>
    esp=<%= node[:strongswan][:server][:tunable][:ipsec][:esp] %>
    # The "left" parameter is the gateway's private IP 
    left=<%= node[:strongswan][:server][:tunable][:ipsec][:left][:left] %>
    leftid=<%= node[:strongswan][:server][:tunable][:ipsec][:left][:id] %>
    # We are protecting the entire VPC, not just this subnet
    leftsubnet=<%= node[:strongswan][:server][:tunable][:ipsec][:left][:subnet] %>
    leftauth=<%= node[:strongswan][:server][:tunable][:ipsec][:left][:leftauth] %>
    leftfirewall=yes
    right=<%= node[:strongswan][:server][:tunable][:ipsec][:right][:right] %>
    rightauth=<%= node[:strongswan][:server][:tunable][:ipsec][:right][:rightauth] %>
    rightauth2=<%= node[:strongswan][:server][:tunable][:ipsec][:right][:rightauth2] %>
    auto=add

# Add connections here.

# include /var/lib/strongswan/ipsec.conf.inc
